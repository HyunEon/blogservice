{% extends 'main/base.html' %}
{% load static %}

{% block title %}{{ blog.blog_title }}{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/blog/blogpage.css' %}">
{% endblock %}

{% block content %}
<div class="container blog-container">
    <aside class="blog-sidebar">
        <h2>ì¹´í…Œê³ ë¦¬</h2>
        <nav class="category-nav">
            <ul>
                <li>
                    <a href="{% url 'showblog' blog_slug=blog.slug %}" class="category-item">ì „ì²´ê¸€ ë³´ê¸°</a>
                </li>
                {% for categories in categories %}
                <li>
                    <a href="{% url 'showblogbycategory' blog_slug=blog.slug category_slug=categories.slug %}" 
                       class="category-item {% if categories.category_isdepth %}category-item-depth{% endif %}">
                        {{ categories.category_name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </nav>
    </aside>

    <section class="post-list-section">
        <div class="search-container">
            {% if category_slug %}
            <form action="{% url 'showblogbycategory' blog_slug=blog.slug category_slug=category_slug %}" method="get" class="search-form">
                <input type="text" name="q" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." value="{{ request.GET.q }}">
                <button type="submit">ğŸ”</button>
            </form>
            {% else %}
            <form action="{% url 'showblog' blog_slug=blog.slug %}" method="get" class="search-form">
                <input type="text" name="q" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." value="{{ request.GET.q }}">
                <button type="submit">ğŸ”</button>
            </form>
            {% endif %}
            <form method="get" class="per-page-form">
                <!-- ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ í‘œì‹œí•œ ê¸€ ìˆ˜ë¥¼ ì¡°ì •í•˜ëŠ” ê²½ìš°ë„ ìˆìœ¼ë¯€ë¡œ, hiddenìœ¼ë¡œ ê²€ìƒ‰ ì¿¼ë¦¬ê°€ ìˆìœ¼ë©´ ë„˜ê²¨ì¤Œ -->
                {% if request.GET.q %}
                <input type="hidden" name="q" value="{{ request.GET.q }}">
                {% endif %}
                <label for="per_page">í‘œì‹œí•  ê¸€ ìˆ˜:</label>
                <select name="per_page" id="per_page" onchange="this.form.submit()">
                    <option value="3" {% if request.GET.per_page == '3' %}selected{% endif %}>3ê°œ</option>
                    <option value="5" {% if request.GET.per_page == '5' %}selected{% endif %}>5ê°œ</option>
                    <option value="10" {% if request.GET.per_page == '10' %}selected{% endif %}>10ê°œ</option>
                    <option value="20" {% if request.GET.per_page == '20' %}selected{% endif %}>20ê°œ</option>
                </select>
            </form>
        </div>

        <div class="post-list">
            {% if posts %}
                {% for post in posts %}
                <article class="post-summary">
                    <header class="post-header">
                        <h2>
                            <a href="{% url 'showpostdetail' post_slug=post.slug blog_slug=blog.slug %}">{{ post.post_title }}</a>
                        </h2>
                        <div class="post-meta">
                            <span>{{ post.post_date|date:"Yë…„ mì›” dì¼ H:i"}}</span>
                        </div>
                    </header>
                    <div class="post-excerpt">
                        <p>{{ post.post_contents|safe|striptags|truncatewords:5 }}</p>
                    </div>
                    <a href="{% url 'showpostdetail' post_slug=post.slug blog_slug=blog.slug %}" class="read-more-link">ë” ë³´ê¸° &rarr;</a>
                </article>
                {% endfor %}
            {% else %}
                {% if request.GET.q %}
                <div class="no-posts">
                    <h3>í……..</h3>
                    <p>ê²€ìƒ‰ëœ í‚¤ì›Œë“œë¡œ ì‘ì„±ëœ ê¸€ì´ í•˜ë‚˜ë„ ì—†ì–´ìš” ğŸ˜¢</p>
                </div>
                {% else %}
                    {% if user == blog.blog_user %}
                    <div class="no-posts">
                        <h3>ì²« ì‹œì‘ì€ ì¤‘ìš”í•œ ë²•ì´ì£ !</h3>
                        <p>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                    {% else %}
                    <div class="no-posts">
                        <h3>ì‘ì„±ëœ ê¸€ì´ ì—†ë„¤ìš”..</h3>
                        <p>{{ blog.blog_user.nickname }}ë‹˜ì€ ì•„ì§ ì¤€ë¹„ ì¤‘ì¸ê°€ ë´ìš” ğŸ˜¢</p>
                        <a href="{% url 'showmain' %}">ê·¸ë™ì•ˆ ë‹¤ë¥¸ ë¸”ë¡œê·¸ë¥¼ ì‚´í´ë³¼ê¹Œìš”?</p>
                    </div>
                    {% endif %} 
                {% endif %}
            {% endif %} 
        </div>

        <div class="pagination">
            <!-- ì´ì „ ë²„íŠ¼ -->
            {% if posts.has_previous %}
            <!-- ê²€ìƒ‰ ì¿¼ë¦¬ & Nê°œ ì”© í¬ìŠ¤íŠ¸ ë³´ê¸° í¬í•¨ -->
                <a href="?page={{ posts.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}" class="page-btn">&lt;</a>
            {% else %}
                <span class="page-btn disabled">&lt;</span>
            {% endif %}

            <!-- í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤ -->
            {% for num in posts.paginator.page_range %}
                {% if num == posts.number %}
                    <span class="page-btn active">{{ num }}</span>
                {% else %}
                    <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}" class="page-btn">{{ num }}</a>
                {% endif %}
            {% endfor %}

            <!-- ë‹¤ìŒ ë²„íŠ¼ -->
            {% if posts.has_next %}
                <a href="?page={{ posts.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}" class="page-btn">&gt;</a>
            {% else %}
                <span class="page-btn disabled">&gt;</span>
            {% endif %}
        </div>
        
        <!-- ë¸”ë¡œê·¸ ì£¼ì¸ì—ê²Œë§Œ í¬ìŠ¤íŠ¸ ì‘ì„± ë²„íŠ¼ ë³´ì´ê²Œ -->
        {% if user == blog.blog_user %}
            <div class="write-post-button-container">
                <a href="{% url 'createpost' %}" class="write-post-btn">âœï¸ ìƒˆ ê¸€ ì‘ì„±</a>
            </div>
        {% endif %}
    </section>
</div>
{% endblock %}